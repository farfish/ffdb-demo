!function r(o,s,l){function u(n,e){if(!s[n]){if(!o[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);var a=new Error("Cannot find module '"+n+"'");throw a.code="MODULE_NOT_FOUND",a}var i=s[n]={exports:{}};o[n][0].call(i.exports,function(e){var t=o[n][1][e];return u(t||e)},i,i.exports,r,o,s,l)}return s[n].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)u(l[e]);return u}({1:[function(require,e,exports){"use strict";function t(e,t){var n,a=[];if(t<e)throw new Error("Minimum ("+e+") should be smaller than maximum ("+t+")");for(n=e;n<=t;n++)a.push(n.toString());return a}function n(e){this.values=e.values}function a(e,t){var n=(t||[e.min,e.max]).map(Number).filter(function(e){return!isNaN(e)});this.initial=e.initial||[],this.min=Math.min.apply(null,n),this.max=Math.max.apply(null,n),this.overall_min=e.overall_min||1900,this.overall_max=e.overall_max||2050}function i(e,t){this.count=t?t.length:e.count,this.overall_max=e.overall_max||1e3}n.prototype.parameterHtml=function(){return""},n.prototype.headers=function(){return this.values.map(function(e){return e[0]})},n.prototype.headerHTML=function(){return this.values.map(function(e){return e[1]})},n.prototype.minCount=function(){return this.values.length},n.prototype.maxCount=function(){return this.values.length},a.prototype.parameterHtml=function(){return['<label>Start year: <input type="number" name="year_start" min="'+this.overall_min+'" max="'+this.overall_max+'" step="1" value="'+this.min+'" /></label>','<label>End year: <input type="number" name="year_end" min="'+this.overall_min+'" max="'+this.overall_max+'" step="1" value="'+this.max+'" /></label>'].join("\n")},a.prototype.headers=function(){return this.initial.concat(t(this.min,this.max))},a.prototype.headerHTML=a.prototype.headers,a.prototype.minCount=function(){return this.initial.length+this.max-this.min+1},a.prototype.maxCount=function(){return this.initial.length+this.max-this.min+1},a.prototype.update=function(e,t,n){var a,i,r=e.querySelector("input[name=year_start]"),o=e.querySelector("input[name=year_end]");for(n.target.id===r.id?(o.min=r.value,o.value<o.min&&(o.value=o.min)):n.target.id===o.id&&(r.max=o.value,r.value>r.max&&(r.value=r.max)),this.min=parseInt(r.value,10),this.max=parseInt(o.value,10),i=this.headers(),a=t.getColHeader(),t.updateSettings({minCols:this.initial.length,maxCols:i.length});;){if(a[this.initial.length]>i[this.initial.length])a.splice(this.initial.length,0,a[this.initial.length]-1),t.alter("insert_col",this.initial.length);else if(a[this.initial.length]<i[this.initial.length])a.splice(this.initial.length,1),t.alter("remove_col",this.initial.length);else if(a[a.length-1]<i[i.length-1])a.push(a[a.length-1]+1),t.alter("insert_col",a.length);else{if(!(a[a.length-1]>i[i.length-1]))break;a.pop(),t.alter("remove_col",a.length)}t.updateSettings({colHeaders:a})}},i.prototype.parameterHtml=function(){return['<label>Bins: <input type="number" name="bin_count" min="0" max="'+this.overall_max+'" step="1" value="'+this.count+'" /></label>'].join("\n")},i.prototype.headers=function(){return t(1,this.count)},i.prototype.headerHTML=i.prototype.headers,i.prototype.minCount=function(){return this.count},i.prototype.maxCount=function(){return this.count},i.prototype.update=function(e,t,n){var a,i,r=e.querySelector("input[name=bin_count]");for(this.count=parseInt(r.value,10),i=this.headers(),t.updateSettings({minCols:0,maxCols:i.length});;){if((a=t.getColHeader())[0]>i[0])a.unshift(a[0]-1),t.alter("insert_col",0);else if(a[0]<i[0])a.shift(),t.alter("remove_col",0);else if(a[a.length-1]<i[i.length-1])a.push(a[a.length-1]+1),t.alter("insert_col",a.length);else{if(!(a[a.length-1]>i[i.length-1]))break;a.pop(),t.alter("remove_col",a.length)}t.updateSettings({colHeaders:a})}},e.exports.get_dimension=function(e,t){return new{list:n,year:a,bins:i}[e.type](e,t)}},{}],2:[function(require,e,exports){"use strict";e.exports=function(e,n,a){var t=document.querySelector("span.file_loader."+e);t&&(document.body.removeChild(t),t=null),(t=document.createElement("SPAN")).innerHTML='<input type="file" style="visibility: hidden; position: absolute; top: 0px; left: 0px; height: 0px; width: 0px;">',t=t.children[0],document.body.appendChild(t),t.addEventListener("change",function(e){var t=new FileReader;t.onload=function(e){a.call(this,e.target.result)},"binary"===n?t.readAsBinaryString(e.target.files[0]):"array"===n?t.readAsArrayBuffer(e.target.files[0]):t.readAsText(e.target.files[0],n||"utf-8")}),t.click()}},{}],3:[function(require,e,exports){"use strict";var n=require("jquery"),c=require("handsontable"),h=require("./dimensions.js").get_dimension,a=require("./templates.js").table_templates,m=require("./hot_utils.js");e.exports.generate_hots=function(e,l){var t,u=document.getElementById("tbl");return u.innerHTML="",t=a[e].map(function(e){var a,t,n,i,r={},o=document.createElement("div"),s=(l||{})[e.name]||{_headings:{}};return u.appendChild(o),e.text?(o.innerHTML=e.text,null):(r.fields=h(e.fields,s._headings.fields),r.values=h(e.values,s._headings.values),n="vertical"===e.orientation?r.values:r.fields,i="vertical"===e.orientation?r.fields:r.values,o.innerHTML=["<h3>"+(e.title||e.name)+"</h3>",e.description?"<p>"+e.description+"</p>":"",'<div class="parameters">','<span class="cols">'+n.parameterHtml()+"</span>",'<span class="rows">'+i.parameterHtml()+"</span>","</div>",'<div class="hot"></div>'].join("\n"),(t=JSON.parse(JSON.stringify(e.params||{}))).stretchH="all",t.autoWrapRow=!0,t.rowHeaders=i.headerHTML(),t.minRows=i.minCount(),t.maxRows=i.maxCount(),t.colHeaders=n.headerHTML(),t.minCols=n.minCount(),t.maxCols=n.maxCount(),t.data=s._headings.fields?m.df_to_aofa(s,r.fields.headers(),r.values.headers(),e.orientation):void 0,(a=new c(o.querySelector(".hot"),t)).customData=r,o.querySelector(".parameters > .cols").addEventListener("change",function(e){n.update(o.querySelector(".parameters > .cols"),a,e)}),o.querySelector(".parameters > .rows").addEventListener("change",function(e){i.update(o.querySelector(".parameters > .rows"),{updateSettings:function(t){var n={};return Object.keys(t).map(function(e){n[e.replace("Col","Row").replace("col","row")]=t[e]}),a.updateSettings(n)},getColHeader:function(){return a.getRowHeader()},alter:function(e,t,n){return a.alter(e.replace("_col","_row"),t,n)}},e)}),a)}),n("#buttons button").prop("disabled",!1),t.tmpl=a[e],t}},{"./dimensions.js":1,"./hot_utils.js":4,"./templates.js":5,handsontable:"handsontable",jquery:"jquery"}],4:[function(require,e,exports){"use strict";function r(e){var t,n,a;function i(e,t){var n,a=[];for(n=0;n<e;n++)a.push(t());return a}for(t=i(e[0].length,function(){return i(e.length,function(){return[]})}),n=0;n<e.length;n++)for(a=0;a<e[0].length;a++)t[a][n]=e[n][a];return t}e.exports.df_to_aofa=function(a,e,t,n){var i;return i=e.map(function(n){return t.map(function(e){var t=a._headings.values.indexOf(e);return 0<=t&&(a[n]||{})[t]||null})}),"vertical"!==n&&(i=r(i)),i},e.exports.aofa_to_df=function(e,t){var n,a={_headings:{fields:[]}};for("vertical"!==t&&(e=r(e)),a._headings.values=e.shift(),a._headings.values.shift(),a._headings.fields=[],n=0;n<e.length;n++)a._headings.fields.push(e[n][0]),a[e[n][0]]=e[n].slice(1);return a}},{}],5:[function(require,e,exports){"use strict";e.exports.table_templates={dlmtool:[{name:"metadata",title:"Data description",description:" Please fill the form with all the data available for your stock, if you are not sure about the value of some category please enter 'NA'. If a field heading is underlined you can hover over for a more detailed description.</p><p>Based on DLMtool package (Tom Carruthers and Adrian Hordyk (2016). DLMtool: Data-Limited Methods Toolkit. R package version 3.1. <a href=\"https://CRAN.R-project.org/package=DLMtool\">https://CRAN.R-project.org/package=DLMtool</a>).",orientation:"vertical",fields:{type:"list",values:[["species","Species"],["location","Location"],["case_study","Case study"]]},values:{type:"list",values:[["value","Value"]]},params:{rowHeaderWidth:140}},{name:"catch",title:"Catch data",description:" Catch data should be in tonnes.",orientation:"vertical",fields:{type:"list",values:[["catch","Catch"],["abundance_index","Abundance index"]]},values:{type:"year",min:2e3,max:2010},params:{rowHeaderWidth:170}},{name:"caa",title:"Catch at age",description:"Age data should be in numbers.",orientation:"horizontal",fields:{type:"bins",count:10},values:{type:"year",min:2e3,max:2010}},{name:"cal",title:"Catch at length",description:"Length data should be in mm.",orientation:"horizontal",fields:{type:"bins",count:10},values:{type:"year",min:2e3,max:2010,initial:["Min Length"]},params:{rowHeaderWidth:100}},{name:"constants",title:"Constants",description:" In the 'source' field write for each value a reference source, this could be a bibliographic or a database (e.g. www.fishbase.org, http://ramlegacy.org) if available. If you do not have a reference but you have some knowledge on the value or if a reference does not apply please enter 'NA'.",orientation:"vertical",fields:{type:"list",values:[["avg_catch_over_time","Average catch over time t"],["depletion_over_time",'<abbr title="Estimated biomass in the last year divided by estimated biomass at the beginning of time series">Depletion over time t</abbr>'],["M",'<abbr title="Instantaneous natural mortality rate (year⁻¹)">M: Instantaneous natural mortality rate</a>'],["FMSY/M","FMSY/M"],["BMSY/B0",'<abbr title="The most productive stock size relative to unfished biomass">BMSY/B0</abbr>'],["MSY","MSY"],["BMSY","BMSY"],["length_at_50pc_maturity","Length at 50% maturity"],["length_at_95pc_maturity","Length at 95% maturity"],["length_at_first_capture","Length at first capture"],["length_at_full_selection","Length at full selection"],["current_stock_depletion",'<abbr title="Biomass today divided by unfished biomass (B0)">Current stock depletion</abbr>'],["current_stock_abundance",'<abbr title="Estimated abundance today">Current stock abundance</abbr>'],["Von_Bertalanffy_K",'<abbr title="Growth rate parameter">Von Bertalanffy K parameter</abbr>'],["Von_Bertalanffy_Linf","Von Bertalanffy Linf parameter"],["Von_Bertalanffy_t0","Von Bertalanffy t0 parameter"],["Length-weight_parameter_a","Length-weight param a (W=aLᵇ)"],["Length-weight_parameter_b","Length-weight param b (W=aLᵇ)"],["maximum_age","Maximum age"],["ref_ofl_limit",'<abbr title="Reference Overfishing limit or reference catch limit e.g. previous catch recommendation">Reference Overfishing/catch limit</abbr>']]},values:{type:"list",values:[["value","Value"],["source","Source"]]},params:{rowHeaderWidth:330}},{name:"cv",title:"Coefficient of variation",description:"CV is a measure of imprecision, i.e. how imprecise you think this value could be",orientation:"vertical",fields:{type:"list",values:[["catch","CV Catch"],["depletion_over_time","CV Depletion over time t"],["avg_catch_over_time","CV Average catch over time t"],["abundance_index","CV Abundance index"],["M","CV M"],["FMSY/M","CV FMSY/M"],["BMSY/B0","CV BMSY/B0"],["current_stock_depletion","CV current stock depletion"],["current_stock_abundance","CV current stock abundance"],["Von_Bertalanffy_K","CV von B. K parameter"],["Von_Bertalanffy_Linf","CV von B. Linf parameter"],["Von_Bertalanffy_t0","CV von B. t0 parameter"],["length_at_50pc_maturity","CV Length at 50% maturity"],["length_at_first_capture","CV Length at first capture"],["length_at_full_selection","CV Length at full selection"],["Length-weight_parameter_a","CV Length-weight parameter a"],["Length-weight_parameter_b","CV Length-weight parameter b"],["length_composition","Imprecision in length composition data"]]},values:{type:"list",values:[["value","Value"],["source","Source"]]},params:{rowHeaderWidth:270}}]}},{}],6:[function(require,e,exports){"use strict";var l,n,t,u=require("xlsx"),a=require("./file_loader.js"),i=require("file-saver"),r=require("jquery"),o=require("./hot_generate.js").generate_hots,s=require("./templates.js").table_templates,c=require("./hot_utils.js"),h=(require("selectize"),require("alerts"));function m(e){return document.querySelector("body").classList.add("loading"),e.then(function(){document.querySelector("body").classList.remove("loading")}).catch(function(e){throw document.querySelector("body").classList.remove("loading"),h(e,{className:"error"}),e})}h.transitionTime=300,document.querySelector("#options button[name=save]").addEventListener("click",function(e){var s={},t=document.querySelector("#options *[name=filename]").value;l.map(function(e,t){var n,a,i=l.tmpl[t],r={_headings:{}};function o(e){return e[n]}if(i.name){for(a=e.getData(),r._headings.fields=e.customData.fields.headers(),r._headings.values=e.customData.values.headers(),n=0;n<r._headings.fields.length;n++)"vertical"===i.orientation?r[r._headings.fields[n]]=a[n]:r[r._headings.fields[n]]=a.map(o);s[i.name]=r}}),m(window.fetch("/api/doc/dlmtool/"+encodeURIComponent(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(e){return e.json()}).then(function(e){n.updateOption(e.document_name,{value:e.document_name,text:e.document_name+" (v"+e.version+")"}),h("Saved",{className:"success",timeout:3e3})}))}),document.querySelector("#options button[name=export]").addEventListener("click",function(e){var s={SheetNames:[],Sheets:{}},t=document.querySelector("#options *[name=filename]").value;t?(l.map(function(e,t){var n,a,i,r,o=l.tmpl[t];if(o.name){for(a=e.getData(),i=e.customData["vertical"===o.orientation?"fields":"values"].headers(),r=e.customData["vertical"===o.orientation?"values":"fields"].headers(),a.unshift(r),n=0;n<a.length;n++)a[n].unshift(0<n?i[n-1]:null);s.SheetNames.push(o.name),s.Sheets[o.name]=u.utils.aoa_to_sheet(a)}}),i.saveAs(new Blob([function(e){var t,n=new window.ArrayBuffer(e.length),a=new window.Uint8Array(n);for(t=0;t<e.length;++t)a[t]=255&e.charCodeAt(t);return n}(u.write(s,{bookType:"xlsx",bookSST:!0,type:"binary"}))],{type:"application/octet-stream"}),t+".xlsx")):window.alert("You must enter a filename in the box above")}),document.querySelector("#options button[name=import]").addEventListener("click",function(e){a("import-csv","array",function(e){var i={},r=u.read(new window.Uint8Array(e),{type:"array"});l.map(function(e,t){var n=l.tmpl[t],a=r.Sheets[n.name];a&&(i[n.name]=c.aofa_to_df(u.utils.sheet_to_json(a,{header:1}),n.orientation))}),l=o(document.querySelector("select[name=template]").value,i)})}),t=r("select[name=template]").selectize({preload:!0,loadThrottle:null,load:function(e,t){var n=Object.keys(s);m(new Promise(function(e){t(n.map(function(e){return{value:e,text:e}})),e()}).then(function(){this.setValue(n[0])}.bind(this)))}}).on("change",function(e){window.serverless?l=o(t.getValue(),{content:{}}):n.onSearchChange("")})[0].selectize,n=r("select[name=filename]").selectize({loadThrottle:null,load:function(e,t){return m(window.fetch("/api/doc/dlmtool",{method:"GET"}).then(function(e){return e.json()}).then(function(e){t(e.documents.map(function(e){return{value:e.document_name,text:e.document_name+" (v"+e.latest+")"}}))}))},create:!0}).on("change",function(e){m(window.fetch("/api/doc/"+encodeURIComponent(t.getValue())+"/"+encodeURIComponent(e.target.value),{method:"GET"}).then(function(e){return 404===e.status?{content:{}}:e.json()}).then(function(e){l=o(t.getValue(),e.content)}))})[0].selectize,window.serverless&&(document.querySelector("#options button[name=save]").style.display="none",document.querySelector("label.filename").style.display="none")},{"./file_loader.js":2,"./hot_generate.js":3,"./hot_utils.js":4,"./templates.js":5,alerts:7,"file-saver":"file-saver",jquery:"jquery",selectize:"selectize",xlsx:"xlsx"}],7:[function(require,e,exports){var n,a=document.createElement("div"),i=function(e,t){return new r(e,t).show()};i.transitionTime=0,i.containerClassName="alerts",i.showClassName="alert-show",i.dismissClassName="alert-dismiss",i.Alert=r,i.container=a;try{e.exports=i}catch(e){window.al=i}function r(e,t){n||(n=!0,a.className=i.containerClassName,document.body.appendChild(a)),t=t||{},this.options=t,this.message=e||"",this.timeout=t.timeout||!1,this.className=t.className||"",this.onshow=t.onshow,this.ondismiss=t.ondismiss}r.prototype.create=function(){var e=this.el=document.createElement("div"),t=i.transitionTime||0,n=this.className;e.className=["alert",this.className].join(" "),e.innerHTML=this.message,setTimeout(function(){e.className=["alert",i.showClassName,n].join(" ")},t),a.appendChild(this.el)},r.prototype.show=function(){return this.create(),this.configure(),"function"==typeof this.onshow&&this.onshow.call(this.el,this.options),this},r.prototype.configure=function(){var t,n=this;this.timeout&&(t=setTimeout(function(){n.destroy()},this.timeout)),this.el.addEventListener("click",function(e){t&&clearTimeout(t),n.destroy()},!1)},r.prototype.destroy=function(){var e=this.el,t=i.transitionTime||0,n=this;e.className=["alert",i.dismissClassName,this.className].join(" "),setTimeout(function(){"function"==typeof n.ondismiss&&n.ondismiss.call(n),a.removeChild(e)},t)}},{}]},{},[6]);
//# sourceMappingURL=upload.min.js.map